function _findInnerMdcTableInDialog(sMacroLocalId) {
    if (!oDialog) { return null; }

    // Find ALL sap.ui.mdc.Table controls inside the dialog
    var aMdcTables = oDialog.findAggregatedObjects(true, function (o) {
        return o && o.isA && o.isA("sap.ui.mdc.Table");
    }) || [];

    // Prefer the table generated by the macro: "...AttachmentTable::Table" / "...ServiceWRTable::Table"
    return aMdcTables.find(function (t) {
        var sId = t.getId();
        return sId && sId.indexOf(sMacroLocalId + "::Table") !== -1;
    }) || null;
}

function _getSelectedObjectsFromDialogMacroTable(sMacroLocalId) {
    var oMdcTable = _findInnerMdcTableInDialog(sMacroLocalId);
    if (!oMdcTable) { return []; }

    var aCtx = (typeof oMdcTable.getSelectedContexts === "function")
        ? (oMdcTable.getSelectedContexts() || [])
        : [];

    return aCtx.map(function (oCtx) { return oCtx.getObject(); });
}
